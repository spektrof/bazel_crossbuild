# Bazel cross-compilation build test for no-remote actions

Some tools, used by rules, might be platform-dependent.
When it comes to the Bazel actions, execution platform needs to be selected properly in order to run the tool.

## Expectations

Actions, generated by targets with `no-remote` or `no-remote-exec` tags are using the host platform as execution platform.

Actions, generated by targets without the tags above are using the target platform as execution platform, because we run them remotely.

Other built-in actions, generated by the same target, using other toolchains such as C++ toolchains, are using the target platform as execution platform no matter what tag has been specified.

## To run tests:

    $ bazel test :test_group1 --config remote --config rhel8
    //:expecting_rhel8_exec_comp_remote_action_no_exec_c                     PASSED in 0.0s
    //:expecting_rhel7_exec_comp_no_remote_action_no_exec_c                  FAILED in 0.0s

Explanation:

Using the `no-remote-exec` tag only is not enough.
The action tries to run locally on rhel7 with the rhel8 compatible binary.

    $ bazel test :test_group2 --config remote --config rhel8
    //:expecting_rhel7_exec_comp_no_remote_action                             PASSED in 0.0s
    //:expecting_rhel8_exec_comp_remote_action                                PASSED in 0.0s

Explanation:

Using both `no-remote-exec` tag and set `@crossbuild//constrain:host_platform` in `exec_compatible_with` helps
to select the rhel7 compatible tool on a rhel7 host, even if rhel8 remote build was requested.

This requires `--crossbuild=@crossbuild//platform:rhel8`, otherwise rhel7 compatible tool
could be used at remote execution on rhel8 when the target doesn't have `tags` nor `exec_compatible_with`.
